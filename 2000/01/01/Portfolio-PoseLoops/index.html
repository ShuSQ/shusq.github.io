<!DOCTYPE html>
<html lang="en">
    <!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
  
  <title>MusicRNN - AI音乐生成工具PoseLoops - Shu-Creative Computing</title>
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  
    <link rel='manifest' href='/manifest.json'>
  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/cursor.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
  
  
<link rel="stylesheet" href="/css/post.css">

  

<meta name="generator" content="Hexo 5.2.0"></head>


    <body>
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">Shu&#39;s Blog</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">Home</a>
            
            
            <a class="nav-item" href="/categories/essays">Thinking</a>
            
            
            
            <a class="nav-item" href="/categories/pcomp">Pcomp&amp;AVCE</a>
            
            
            
            <a class="nav-item" href="/categories/coding">Coding</a>
            
            
            
            <a class="nav-item" href="/categories/portfolio">Portfolio</a>
            
            
            
            <a class="nav-item" href="/contact">About</a>
            
            
            
            <a class="nav-item nav-item-github nav-item-icon" href="https://github.com/ShuSQ" target="_blank">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-codepen nav-item-icon" href="https://codepen.io/shusq" target="_blank">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-patreon nav-item-icon" href="https://www.instagram.com/cheese_shu/" target="_blank">&nbsp;</a>
            
            
        </div>
    </div>
</nav>
        <article class="post">
    <div class="meta">
        
        <div class="date" id="date">
            
            <span>January</span>
            
            
            
            
            
            
            
            
            
            
            
            
            <span>1,</span>
            <span>2000</span>
        </div>
        

        <h2 class="title">MusicRNN - AI音乐生成工具PoseLoops</h2>
    </div>

    <div class="divider"></div>

    <div class="content">
        <blockquote>
<p>一款基于MusicRNN创建的AI音乐生成工具，通过用户提供的pose数据，神经网络模型可以创建不同的打击旋律。</p>
</blockquote>
<p>A music generation tool combined with Posenet and MusicRNN in the browser.</p>
<p><img src="https://miro.medium.com/max/1400/1*B6CxARS-pTUcKGoHXN4KIA.gif"></p>
<p>You can learn more about the project through the following links:</p>
<p><strong>GitHub📎</strong>: <a target="_blank" rel="noopener" href="https://github.com/ShuSQ/CCI_AP_PoseLoops">CCI_AP_PoseLoops</a></p>
<p><strong>Youtube🎬</strong>: <a target="_blank" rel="noopener" href="https://youtu.be/fTIae_AJdlc">CCI_Advanced Project_PoseLoops</a></p>
<p><strong>CodeSandbox📦</strong>: <a target="_blank" rel="noopener" href="https://iqvt3.csb.app/">Demo</a> <a target="_blank" rel="noopener" href="https://5xiik.csb.app/">Demo2</a>( use Vanta.js background)</p>
<blockquote>
<p>If loops are not generated when you try, you may need to spend a while waiting for the model to be loaded.  (´･_･`)</p>
</blockquote>
<h3 id="Background-and-Idea"><a href="#Background-and-Idea" class="headerlink" title="Background and Idea"></a>Background and Idea</h3><p>With the rapid development of computer technology, AI has been applied in more artistic and creative fields. In my initial plan, I hope to combine machine learning technology and music to create a music generator, which is related to the AI theme. It can create different music content through information from different physical worlds,  and bring a brand new Audio production method. It can also allow anyone who is interested in AI and ML, to stimulate interest in the application of AI technology, through this project and gain more inspiration.</p>
<p>Before starting my project, I collected some cases related to AI and music through Google, social media and other technical blogs, to understand how their creative effects were achieved, and I tried to find clues from them, hopefully I can find some inspiration through them:</p>
<blockquote>
<p>Blocky - run block code</p>
<p>(<a target="_blank" rel="noopener" href="https://blockly-demo.appspot.com/static/demos/code/index.html">https://blockly-demo.appspot.com/static/demos/code/index.html</a>)</p>
<p>Natya*ML - generate music using the interactive input from the user</p>
<p>(<a target="_blank" rel="noopener" href="https://dance-project.glitch.me/">https://dance-project.glitch.me/</a>)</p>
<p>Tonejs - instruments</p>
<p>(<a target="_blank" rel="noopener" href="https://github.com/nbrosowsky/tonejs-instruments">https://github.com/nbrosowsky/tonejs-instruments</a>)</p>
<p>Hyoerscire - music software that lets anyone compose music</p>
<p>(<a target="_blank" rel="noopener" href="https://www.media.mit.edu/projects/hyperscore/overview/">https://www.media.mit.edu/projects/hyperscore/overview/</a>)</p>
<p>Pianoroll RNN-NADE</p>
<p>(<a target="_blank" rel="noopener" href="https://github.com/magenta/magenta/blob/master/magenta/models/pianoroll_rnn_nade/README.md">https://github.com/magenta/magenta/blob/master/magenta/models/pianoroll_rnn_nade/README.md</a>)</p>
<p>Synth - sound maker</p>
<p>(<a target="_blank" rel="noopener" href="https://experiments.withgoogle.com/ai/sound-maker/view/">https://experiments.withgoogle.com/ai/sound-maker/view/</a>)</p>
<p>Assisted Melody -</p>
<p>(<a target="_blank" rel="noopener" href="https://artsexperiments.withgoogle.com/assisted-melody-bach?p=edit#-120-piano">https://artsexperiments.withgoogle.com/assisted-melody-bach?p=edit#-120-piano</a>)</p>
<p>MOD Synth - modular synthesizer</p>
<p>(<a target="_blank" rel="noopener" href="https://www.mod-synth.io/">https://www.mod-synth.io/</a>)</p>
<p>Tacotron: Towards End-to-End Speech Synthesis</p>
<p>(<a target="_blank" rel="noopener" href="https://arxiv.org/abs/1703.10135">https://arxiv.org/abs/1703.10135</a>)</p>
<p>(<a target="_blank" rel="noopener" href="https://google.github.io/tacotron/publications/wave-tacotron/index.html">https://google.github.io/tacotron/publications/wave-tacotron/index.html</a>)</p>
<p>(<a target="_blank" rel="noopener" href="https://google.github.io/tacotron/publications/wave-tacotron/wavetaco-poster.pdf">https://google.github.io/tacotron/publications/wave-tacotron/wavetaco-poster.pdf</a>)</p>
</blockquote>
<p>We can start from a question: What methods can we use to obtain data in the physical world? It can be sound/image/manual input…So in my project plan, I chose three ways to create music loops:</p>
<ol>
<li>Randomly generate seedpattern by adjusting the parameters, and then generate longer loops through the trained DrumRNN model. I liken this process to throwing dice, full of random fun.</li>
<li>Edit the seedpattern by hand, and check the different percussion instruments. If you are a person who knows something about music, this method can help you find more musical inspiration.</li>
<li>Collect human pose information through webcam, and then generate different loops according to different poses, an interactive method that can be explored and fun.</li>
</ol>
<p>After determining the basic interaction method, I need to think more about how to choose a technical solution, so that my ideas can be implemented more efficiently and quickly, tested and further improved.</p>
<h3 id="Technical-Selection-and-Testing"><a href="#Technical-Selection-and-Testing" class="headerlink" title="Technical Selection and Testing"></a>Technical Selection and Testing</h3><p>In this part, I will mainly introduce which technical methods I have selected, and how these technologies help me better achieve my project goals.</p>
<p>The first thing to be clear is, that because I want to quickly test and develop my project, although python or other computer languages may be more efficient in data processing and machine learning, I finally chose JavaScript as my development language. One reason is that browser-based projects can be easily experienced by most people through the Internet, and the other is that I am more familiar with JavaScript, and the development process will be smoother and smoother.</p>
<h4 id="1-How-to-play-audio-via-Tone-js"><a href="#1-How-to-play-audio-via-Tone-js" class="headerlink" title="1. How to play audio via Tone.js"></a>1. How to play audio via Tone.js</h4><p>What is Tone.js?</p>
<p><img src="https://miro.medium.com/max/678/1*CGFdBkwx1WsYf7ZIdXcXKA.png"></p>
<p><a target="_blank" rel="noopener" href="https://tonejs.github.io/">https://tonejs.github.io/</a></p>
<p>Tone.js is a Web Audio framework, developers can use it to create interactive music that can be run in the browser. It has a wealth of synthesizer and parameter control effects. In my project, I mainly use it to control the playback source, and play music according to the array.</p>
<p>The following is a code snippet of my project, showing how Tone.js initializes the convolver, creates drumKit to play the sound sample, and sets the related parameters:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// initializing the convolver with an impulse response 初始化convolver</span></span><br><span class="line"><span class="keyword">let</span> reverb = <span class="keyword">new</span> Tone.Convolver(<span class="string">`assets/small-drum-room.wav`</span>).toMaster();</span><br><span class="line">reverb.wet.value = <span class="number">0.3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DRUM_CLASSES: &#x27;Kick&#x27;, &#x27;Snare&#x27;, &#x27;Hi-hat closed&#x27;, &#x27;Hi-hat open&#x27;, &#x27;Tom low&#x27;, &#x27;Tom mid&#x27;, &#x27;Tom high&#x27;, &#x27;Clap&#x27;, &#x27;Rim&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> drumKit = [</span><br><span class="line">    <span class="keyword">new</span> Tone.Player(<span class="string">`808-kick-vh.mp3`</span>).toMaster(),</span><br><span class="line">    <span class="keyword">new</span> Tone.Player(<span class="string">`flares-snare-vh.mp3`</span>).toMaster(),</span><br><span class="line">    <span class="keyword">new</span> Tone.Player(<span class="string">`808-hihat-vh.mp3`</span>).connect(<span class="keyword">new</span> Tone.Panner(-<span class="number">0.5</span>).connect(reverb)),</span><br><span class="line">    <span class="keyword">new</span> Tone.Player(<span class="string">`808-hihat-open-vh.mp3`</span>).connect(<span class="keyword">new</span> Tone.Panner(-<span class="number">0.5</span>).connect(reverb)),</span><br><span class="line">    <span class="keyword">new</span> Tone.Player(<span class="string">`slamdam-tom-low-vh.mp3`</span>).connect(<span class="keyword">new</span> Tone.Panner(-<span class="number">0.4</span>).connect(reverb)),</span><br><span class="line">    <span class="keyword">new</span> Tone.Player(<span class="string">`slamdam-tom-mid-vh.mp3`</span>).connect(reverb),</span><br><span class="line">    <span class="keyword">new</span> Tone.Player(<span class="string">`slamdam-tom-high-vh.mp3`</span>).connect(<span class="keyword">new</span> Tone.Panner(<span class="number">0.4</span>).connect(reverb)),</span><br><span class="line">    <span class="keyword">new</span> Tone.Player(<span class="string">`909-clap-vh.mp3`</span>).connect(<span class="keyword">new</span> Tone.Panner(<span class="number">0.5</span>).connect(reverb)),</span><br><span class="line">    <span class="keyword">new</span> Tone.Player(<span class="string">`909-rim-vh.wav`</span>).connect(<span class="keyword">new</span> Tone.Panner(<span class="number">0.5</span>).connect(reverb))</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>Through this part of the code, I created drumKit, which can be called to play various sound combinations in my future work.</p>
<h4 id="2-How-to-generate-loops-through-Magenta-and-MusicRNN"><a href="#2-How-to-generate-loops-through-Magenta-and-MusicRNN" class="headerlink" title="2. How to generate loops through Magenta and MusicRNN"></a>2. How to generate loops through Magenta and MusicRNN</h4><p>After creating a drumKit that can be played through Tone.js, we need to find a way, similar to creating “music scores”, and then let drumKit play at a set rhythm; but considering that most people do not have enough music theory knowledge, so I want to add a method that can be automatically generated, so that people without music experience can create good loops. Finally, I found musicRNN. You give it a NoteSequence, and it continues it in the style of your original NoteSequence.</p>
<p>What is musicRNN?</p>
<p><img src="https://colah.github.io/posts/2015-08-Understanding-LSTMs/img/LSTM3-SimpleRNN.png"></p>
<p><a target="_blank" rel="noopener" href="https://magenta.github.io/magenta-js/music/classes/_music_rnn_model_.musicrnn.html">https://magenta.github.io/magenta-js/music/classes/_music_rnn_model_.musicrnn.html</a></p>
<p>We can learn about Magenta’s related description from the above link, “A MusicRNN is an LSTM-based language model for musical notes.” If we provide a quantized NoteSequence, we can use MusicRNN to extend our playback sequence:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> drumRnn = <span class="keyword">new</span> mm.MusicRNN(<span class="string">&#x27;https://storage.googleapis.com/download.magenta.tensorflow.org/tfjs_checkpoints/music_rnn/drum_kit_rnn&#x27;</span>);</span><br><span class="line">drumRnn.initialize();</span><br></pre></td></tr></table></figure>

<p>The model expects a quantized sequence, and ours was unquantized, so we need to create a conversion function:</p>
<p>You can learn a detailed description of the quantizeNoteSequence function here: <a target="_blank" rel="noopener" href="https://magenta.github.io/magenta-js/music/modules/_core_sequences_.html#quantizenotesequence">https://magenta.github.io/magenta-js/music/modules/_core_sequences_.html#quantizenotesequence</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toNoteSequence</span>(<span class="params">pattern</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mm.sequences.quantizeNoteSequence(&#123;</span><br><span class="line">            ticksPerQuarter: <span class="number">220</span>,</span><br><span class="line">            totalTime: pattern.length / <span class="number">2</span>,</span><br><span class="line">            timeSignatures: [&#123;</span><br><span class="line">                time: <span class="number">0</span>,</span><br><span class="line">                numerator: <span class="number">4</span>,</span><br><span class="line">                denominator: <span class="number">4</span></span><br><span class="line">            &#125;],</span><br><span class="line">            tempos: [&#123;</span><br><span class="line">                time: <span class="number">0</span>,</span><br><span class="line">                qpm: <span class="number">120</span></span><br><span class="line">            &#125;],</span><br><span class="line">            notes: _.flatMap(pattern, <span class="function">(<span class="params">step, index</span>) =&gt;</span></span><br><span class="line">                step.map(<span class="function"><span class="params">d</span> =&gt;</span> (&#123;</span><br><span class="line">                    pitch: midiDrums[d],</span><br><span class="line">                    startTime: index * <span class="number">0.5</span>,</span><br><span class="line">                    endTime: (index + <span class="number">1</span>) * <span class="number">0.5</span></span><br><span class="line">                &#125;))</span><br><span class="line">            )</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="number">1</span></span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fromNoteSequence</span>(<span class="params">seq, patternLength</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> res = _.times(patternLength, <span class="function">() =&gt;</span> []);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> &#123; pitch, quantizedStartStep &#125; <span class="keyword">of</span> seq.notes) &#123;</span><br><span class="line">        res[quantizedStartStep].push(reverseMidiMapping.get(pitch));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this function, we will control the playback of Tone.js according to the sequence generated by MusicRNN:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">playPattern</span>(<span class="params">pattern</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    sequence = <span class="keyword">new</span> Tone.Sequence(</span><br><span class="line">        (time, &#123;drums, index&#125;) =&gt; &#123;</span><br><span class="line">            drums.forEach(<span class="function"><span class="params">d</span> =&gt;</span> &#123;</span><br><span class="line">                drumKit[d].start(time)</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        pattern.map(<span class="function">(<span class="params">drums, index</span>) =&gt;</span> (&#123; drums, index &#125;)),</span><br><span class="line">        <span class="string">&#x27;16n&#x27;</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    Tone.context.resume();</span><br><span class="line">    Tone.Transport.start();</span><br><span class="line"></span><br><span class="line">    Tone.Transport.bpm.value = <span class="built_in">parseInt</span>(<span class="built_in">document</span>.getElementById(<span class="string">&quot;bpm&quot;</span>).value);</span><br><span class="line">    sequence.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>At this point, we have realized the serialization of the input array and increasing the length of the array through Magenta.js; and magenta can create a mapping relationship to control the audio playback of Tone.js. The next step is that we need to obtain a seed pattern in different ways, and pass it to Magenta to generate our playback sequence.</p>
<p><img src="https://miro.medium.com/max/720/1*3HsziCbz0V11EsfDYBXtSg.png"></p>
<h4 id="3-How-to-collect-posenet-through-ml5-js"><a href="#3-How-to-collect-posenet-through-ml5-js" class="headerlink" title="3. How to collect posenet through ml5.js"></a>3. How to collect posenet through ml5.js</h4><p>What is ml5.js?</p>
<p><a target="_blank" rel="noopener" href="https://ml5js.org/">https://ml5js.org</a></p>
<p>ml5.js is a friendly deep learning framework based on tensorflow.js, which can be run in a browser, and what I need to use is one of the machine learning models: PoseNet. Collect data through Webcam, and then provide the node information we need.</p>
<p>You can find the official sketch.js in the repostories of GitHub for a quick trial.</p>
<p>Now I create a canvas to display the video information collected by the webcam, and introduce ml5.poseNet.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> video;</span><br><span class="line"><span class="keyword">let</span> poseNet;</span><br><span class="line"><span class="keyword">let</span> poses = [];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> mycanvas = createCanvas(<span class="number">540</span>, <span class="number">398</span>);</span><br><span class="line">    mycanvas.parent(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">    strokeWeight(<span class="number">4</span>);</span><br><span class="line">    stroke(<span class="number">51</span>);</span><br><span class="line">    video = createCapture(VIDEO);</span><br><span class="line">    video.size(width, height);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过单人检测闯进啊一个新的posetNet方法</span></span><br><span class="line">    poseNet = ml5.poseNet(video, modelReady);</span><br><span class="line">    <span class="comment">// 这里设置了一个时间，填充全局变量“pose”</span></span><br><span class="line">    <span class="comment">// 当新的pose被检测时会有一个数组</span></span><br><span class="line">    poseNet.on(<span class="string">&quot;pose&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">results</span>) </span>&#123;</span><br><span class="line">        poses = results;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 隐藏视频元素，只显示canvas</span></span><br><span class="line">    video.hide();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">modelReady</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;model Loaded!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then, in order to facilitate us to have expectations of the collected location information, we draw the keypoints on the canvas:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    image(video, <span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 我们可以调用该函数来绘制所有的关键点和骨骼</span></span><br><span class="line">    drawKeypoints();</span><br><span class="line">    drawSkeleton();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为检测的关键点绘制ellipses</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawKeypoints</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 通过所有的检测循环实现</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; poses.length; i += <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> pose = poses[i].pose;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; pose.keypoints.length; j += <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> keypoint = pose.keypoints[j];</span><br><span class="line">            <span class="comment">// 只有当可信度大于0.2的时候才绘制</span></span><br><span class="line">            <span class="keyword">if</span> (keypoint.score &gt; <span class="number">0.01</span>) &#123;</span><br><span class="line">                fill(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                noStroke();</span><br><span class="line">                ellipse(keypoint.position.x, keypoint.position.y, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绘制skeletons的函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawSkeleton</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 通过所有检测骨骼循环</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; poses.length; i += <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> skeleton = poses[i].skeleton;</span><br><span class="line">        <span class="comment">// 为每一个骨骼循环所有的body连接</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; skeleton.length; j += <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> partA = skeleton[j][<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">const</span> partB = skeleton[j][<span class="number">1</span>];</span><br><span class="line">            stroke(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">            line(partA.position.x, partA.position.y, partB.position.x, partB.position.y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Next, we store the collected keypoints coordinates into a 9x10 matrix as the seedpattern of the long and short-term memory model provided to MusicRNN.</p>
<p><img src="https://colah.github.io/posts/2015-08-Understanding-LSTMs/img/LSTM3-chain.png"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在这里我们通过keypoints的坐标来生成一个新的数组</span></span><br><span class="line"><span class="comment">// console.log(poses[0][&#x27;pose&#x27;][&#x27;keypoints&#x27;][0][&#x27;position&#x27;][&#x27;x&#x27;])</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> seedArrayX = [];</span><br><span class="line"><span class="keyword">let</span> seedArrayY = [];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">arrayMap</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 获取到keypoints的x坐标信息</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">        seedArrayX[i] = <span class="built_in">Math</span>.round(poses[<span class="number">0</span>][<span class="string">&#x27;pose&#x27;</span>][<span class="string">&#x27;keypoints&#x27;</span>][i][<span class="string">&#x27;position&#x27;</span>][<span class="string">&#x27;x&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(seedArrayX);</span><br><span class="line">    <span class="keyword">var</span> max_X = <span class="built_in">Math</span>.max.apply(<span class="literal">null</span>, seedArrayX);</span><br><span class="line">    <span class="keyword">var</span> min_X = <span class="built_in">Math</span>.min.apply(<span class="literal">null</span>, seedArrayX);</span><br><span class="line">    <span class="built_in">console</span>.log(max_X, min_X);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取到keypoints的y坐标信息</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">        seedArrayY[i] = <span class="built_in">Math</span>.round(poses[<span class="number">0</span>][<span class="string">&#x27;pose&#x27;</span>][<span class="string">&#x27;keypoints&#x27;</span>][i][<span class="string">&#x27;position&#x27;</span>][<span class="string">&#x27;y&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(seedArrayY);</span><br><span class="line">    <span class="keyword">var</span> max_Y = <span class="built_in">Math</span>.max.apply(<span class="literal">null</span>, seedArrayY);</span><br><span class="line">    <span class="keyword">var</span> min_Y = <span class="built_in">Math</span>.min.apply(<span class="literal">null</span>, seedArrayY);</span><br><span class="line">    <span class="built_in">console</span>.log(max_Y, min_Y);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// .............</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//  在这里我们预先生成一个空的数组[10x9]，存储和映射webcam收集的坐标信息</span></span><br><span class="line">    <span class="keyword">var</span> bodyArray = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> k = <span class="number">0</span>; k &lt; <span class="number">10</span>; k++)&#123;</span><br><span class="line">        bodyArray[k] = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">9</span>; j++) &#123;</span><br><span class="line">            bodyArray[k][j] = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将生成的数组打印出来</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;empty bodyArray:&quot;</span> + bodyArray);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将坐标信息映射到生成的bodyArray数组中</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">        bodyArray[seedArrayX[i]][seedArrayY[i]] = seedArrayY[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印更新后的bodyArray检查是否输入</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;updated bodyArray:&quot;</span> + bodyArray);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将数组中的空元素滤出</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        bodyArray[i] = bodyArray[i].filter(<span class="function"><span class="params">number</span> =&gt;</span> number != <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将过滤处理的数组打印</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;filtered bodyArray:&quot;</span> + bodyArray);</span><br><span class="line">    seedPattern = bodyArray;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally, the bodyArray we get is our seedPattern, which can be passed to MusicRNN, and then the loops can be generated through pose.</p>
<p><img src="https://miro.medium.com/max/400/1*doDWo6ptKiFe7hLJA2IEhw.png"></p>
<h4 id="4-How-to-generate-a-random-array"><a href="#4-How-to-generate-a-random-array" class="headerlink" title="4. How to generate a random array"></a>4. How to generate a random array</h4><p>This part is relatively simple, we only need to create the relevant HTML tag elements, and then provide a function to generate a two-dimensional array to complete the function of random generation:</p>
<p><img src="https://miro.medium.com/max/400/1*RQElhsexb3ZjcMJb9l4iXQ.png"></p>
<p>First, we create three <code>&lt;div&gt;</code> elements in index.html to help us obtain and provide controllable random parameters:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text1&quot;</span>&gt;</span>ranArrayLen: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;range&quot;</span> <span class="attr">min</span>=<span class="string">&quot;1&quot;</span> <span class="attr">max</span>=<span class="string">&quot;9&quot;</span> <span class="attr">id</span>=<span class="string">&quot;ranArrayLength&quot;</span> <span class="attr">oninput</span>=<span class="string">&quot;lengthChange()&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;lengthValue&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text1&quot;</span>&gt;</span>ranArrayMin: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;range&quot;</span> <span class="attr">min</span>=<span class="string">&quot;0&quot;</span> <span class="attr">max</span>=<span class="string">&quot;8&quot;</span> <span class="attr">id</span>=<span class="string">&quot;ranArrayMin&quot;</span> <span class="attr">oninput</span>=<span class="string">&quot;minChange()&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;minValue&quot;</span>&gt;</span>4<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text1&quot;</span>&gt;</span>ranArrayMax: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;range&quot;</span> <span class="attr">min</span>=<span class="string">&quot;0&quot;</span> <span class="attr">max</span>=<span class="string">&quot;9&quot;</span> <span class="attr">id</span>=<span class="string">&quot;ranArrayMax&quot;</span> <span class="attr">oninput</span>=<span class="string">&quot;maxChange()&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;maxValue&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Then in main.js, write down the function that controls the random generation, mainly through the superposition of two one-bit arrays, but we need to consider the array to do some sorting and filtering of duplicates:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在这里我们提供随机生成二维数组，随机构建melody</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ddArray= [];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 随机生成一维数组</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ranArray</span>(<span class="params">len, min, max</span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">Array</span>.from(&#123;<span class="attr">length</span>:len&#125;, <span class="function"><span class="params">v</span>=&gt;</span><span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*(max-min))+min);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组滤重</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unique</span> (<span class="params">arr</span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">Array</span>.from(<span class="keyword">new</span> <span class="built_in">Set</span>(arr))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组排序</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resort</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> arr.sort(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>)</span>&#123;<span class="keyword">return</span> a - b&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成二维数组</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">randomArray</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ranArrayLen = <span class="built_in">parseInt</span>(<span class="built_in">document</span>.getElementById(<span class="string">&#x27;ranArrayLength&#x27;</span>).value);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ranArrayMin = </span><br><span class="line">      <span class="built_in">parseInt</span>(<span class="built_in">document</span>.getElementById(<span class="string">&#x27;ranArrayMin&#x27;</span>).value);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ranArrayMax = </span><br><span class="line">      <span class="built_in">parseInt</span>(<span class="built_in">document</span>.getElementById(<span class="string">&#x27;ranArrayMax&#x27;</span>).value);</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    ddArray[i] = resort(unique(ranArray(ranArrayLen, ranArrayMin, ranArrayMax)));</span><br><span class="line">    seedPattern = ddArray;</span><br><span class="line">    <span class="built_in">console</span>.log(seedPattern);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-How-to-generate-input-group-and-create-seedpattern"><a href="#5-How-to-generate-input-group-and-create-seedpattern" class="headerlink" title="5. How to generate input group and create seedpattern"></a>5. How to generate input group and create seedpattern</h4><p>In this part, we will build an input group that allows users to create their own seedpattern by checking the form. The advantage of this method is that users can pass a seedpattern to MusicRNN more intuitively and clearly, and then get an AI Generated loops. Here, I used a clumsy method to achieve this, which is to create a large number of <code>&lt;input&gt;</code> tags in HTML. In fact, we can also use some frameworks, vue.js or react.js to create virtual DOM elements through JavaScript. , But I did not try:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">“checkboxGroup”</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;row1&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: inline-block;&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cbox0-0&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: block;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;audioBox&quot;</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cbox0-1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: block;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;audioBox&quot;</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cbox0-2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: block;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;audioBox&quot;</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cbox0-3&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: block;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;audioBox&quot;</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cbox0-4&quot;</span> <span class="attr">value</span>=<span class="string">&quot;4&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: block;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;audioBox&quot;</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cbox0-5&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: block;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;audioBox&quot;</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cbox0-6&quot;</span> <span class="attr">value</span>=<span class="string">&quot;6&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: block;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;audioBox&quot;</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cbox0-7&quot;</span> <span class="attr">value</span>=<span class="string">&quot;7&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: block;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;audioBox&quot;</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cbox0-8&quot;</span> <span class="attr">value</span>=<span class="string">&quot;8&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: block;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;audioBox&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  // ....</span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Yes, I just created 90 <code>&lt;input&gt;</code> elements on the interface like this, which is not a good way.</p>
<p>I use the element of <code>id=&quot;row1&quot;</code> to briefly explain my implementation process. First, declare some variables:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> darray = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line"><span class="keyword">var</span> seedPattern = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">&quot;btn&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> checkboxGroup = <span class="built_in">document</span>.getElementsByClassName(<span class="string">&quot;audioBox&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>Then get the corresponding label element:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1 = <span class="built_in">document</span>.getElementById(<span class="string">&quot;row1&quot;</span>).getElementsByTagName(<span class="string">&quot;input&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>Then add the click event of <code>&lt;input&gt;</code> and add it to the array:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  btn.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> rArray1 = []; </span><br><span class="line">  <span class="comment">// ...  </span></span><br><span class="line">    </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; obj1.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (obj1[i].value.length &gt; <span class="number">0</span> &amp;&amp; obj1[i].checked == <span class="literal">true</span>) &#123;</span><br><span class="line">      rArray1.push(<span class="built_in">parseInt</span>(obj1[i].value));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">    </span><br><span class="line">  darray[<span class="number">0</span>] = rArray1;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  </span><br><span class="line">  seedPattern = darray;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this process, we created a temporary array rArray1 to help us store information, because this is a process of converting a one-dimensional array into a two-dimensional array, so we need to retain the order information when it is generated.</p>
<p>Then in order to ensure the friendliness of the project, a clean function was added:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&quot;cleanBtn&quot;</span>).addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; checkboxGroup.length; i++) &#123;</span><br><span class="line">     checkboxGroup[i].checked = <span class="literal">false</span>;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>

<p>After clicking <code>cleanBtn</code>, all input states in the checkboxGroup will be set to false.</p>
<h4 id="6-How-to-adjust-the-web-GUI-and-style"><a href="#6-How-to-adjust-the-web-GUI-and-style" class="headerlink" title="6. How to adjust the web GUI and style"></a>6. How to adjust the web GUI and style</h4><p>In the final interface visual design, I chose a relatively simple solid color style, which allows users to focus more on the interaction with interface elements. Similarly, I also added a js animation library (https ://zzz.dog), to help me create the loop animation on the loading interface, I also refer to the button styles of many other people, these elements enrich my project, so that users will not be so monotonous when they try; In CSS, the difficulty encountered is to adjust the native label elements. It takes a lot of time to understand how an input is defined. Of course, it also requires constant adjustment of parameters to achieve an ideal effect. This requires no little patience.</p>
<p><img src="https://cdn-images-1.medium.com/max/960/1*TpY3HFezg-CqDlewhhKDBw.png"></p>
<h4 id="7-Summary-and-Outlook"><a href="#7-Summary-and-Outlook" class="headerlink" title="7. Summary and Outlook"></a>7. Summary and Outlook</h4><p>PoseLoops is a simple AI-driven music interactive project. Users can generate a unique melody through the posture information captured by webcam. Of course, users can also provide input to the neural network and generate unique output through random mode and editing mode. .</p>
<p>After finishing the project, I will think, in what areas can I make more attempts, for example, is it possible to add image recognition? Create a seedpattern by recognizing pictures, and then generate loops through AI. Because webcam’s capture capability is limited, other art paintings or some landscapes taken can be converted into input, which makes it possible to create loops; another idea is , Can we consider providing microphone input, by re-interpreting the melody of the input sound through drumkit, this will also be a new idea that can be tried.</p>
<h3 id="Related-readings"><a href="#Related-readings" class="headerlink" title="Related readings:"></a>Related readings:</h3><p>Want to Generate your own Music using Deep Learning? Here’s a Guide to do just that!</p>
<p><a target="_blank" rel="noopener" href="https://www.analyticsvidhya.com/blog/2020/01/how-to-perform-automatic-music-generation/">https://www.analyticsvidhya.com/blog/2020/01/how-to-perform-automatic-music-generation/</a></p>
<p>LSTMs for Music Generation</p>
<p><a target="_blank" rel="noopener" href="https://towardsdatascience.com/lstms-for-music-generation-8b65c9671d35">https://towardsdatascience.com/lstms-for-music-generation-8b65c9671d35</a></p>
<p>How to Generate Music using a LSTM Neural Network in Keras</p>
<p><a target="_blank" rel="noopener" href="https://towardsdatascience.com/how-to-generate-music-using-a-lstm-neural-network-in-keras-68786834d4c5">https://towardsdatascience.com/how-to-generate-music-using-a-lstm-neural-network-in-keras-68786834d4c5</a></p>
<p>Using tensorflow to compose music</p>
<p><a target="_blank" rel="noopener" href="https://www.datacamp.com/community/tutorials/using-tensorflow-to-compose-music">https://www.datacamp.com/community/tutorials/using-tensorflow-to-compose-music</a></p>
<p>Melody Mixer: Using TensorFlow.js to Mix Melodies in the Browser</p>
<p><a target="_blank" rel="noopener" href="https://medium.com/@torinblankensmith/melody-mixer-using-deeplearn-js-to-mix-melodies-in-the-browser-8ad5b42b4d0b">https://medium.com/@torinblankensmith/melody-mixer-using-deeplearn-js-to-mix-melodies-in-the-browser-8ad5b42b4d0b</a></p>
<p>WaveNet: A Generative model for raw audio</p>
<p><a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1609.03499.pdf">https://arxiv.org/pdf/1609.03499.pdf</a></p>
<p>A guide to WaveNet</p>
<p><a target="_blank" rel="noopener" href="https://github.com/AhmadMoussa/A-Guide-to-Wavenet">https://github.com/AhmadMoussa/A-Guide-to-Wavenet</a></p>
<p>A 2019 Guide to Speech Synthesis with Deep Learning</p>
<p><a target="_blank" rel="noopener" href="https://heartbeat.fritz.ai/a-2019-guide-to-speech-synthesis-with-deep-learning-630afcafb9dd">https://heartbeat.fritz.ai/a-2019-guide-to-speech-synthesis-with-deep-learning-630afcafb9dd</a></p>
<p>MusicVAE</p>
<p><a target="_blank" rel="noopener" href="https://notebook.community/magenta/magenta-demos/colab-notebooks/MusicVAE">https://notebook.community/magenta/magenta-demos/colab-notebooks/MusicVAE</a></p>
<p>Contemporary Machine Learning for Audio and Music Generation on the Web: Current Challenges and Potential Solutions</p>
<p><a target="_blank" rel="noopener" href="https://ualresearchonline.arts.ac.uk/id/eprint/15058/1/ICMC2018-MG-MYK-LM-MZ-CK-CAMERA-READY.pdf">https://ualresearchonline.arts.ac.uk/id/eprint/15058/1/ICMC2018-MG-MYK-LM-MZ-CK-CAMERA-READY.pdf</a></p>
<p>Music control with ml5.js</p>
<p><a target="_blank" rel="noopener" href="https://fernandaromero85.medium.com/music-control-with-ml5-js-5b3f9de190e0">https://fernandaromero85.medium.com/music-control-with-ml5-js-5b3f9de190e0</a></p>
<p>ml5.js Sound Classifier Bubble Popper</p>
<p><a target="_blank" rel="noopener" href="https://dmarcisovska.medium.com/ml5-js-sound-classifier-bubble-popper-fac1546a5bad">https://dmarcisovska.medium.com/ml5-js-sound-classifier-bubble-popper-fac1546a5bad</a></p>
<p>Build a Drum Machine with JavaScript, HTML and CSS</p>
<p><a target="_blank" rel="noopener" href="https://medium.com/@iminked/build-a-drum-machine-with-javascript-html-and-css-33a53eeb1f73">https://medium.com/@iminked/build-a-drum-machine-with-javascript-html-and-css-33a53eeb1f73</a></p>
<p>Creative Audio Programming for the Web with Tone.js</p>
<p><a target="_blank" rel="noopener" href="http://annaxambo.me/assets/slides/2020-09-25-slides-creative-audio-programming-for-the-web-with-tone-js.pdf">http://annaxambo.me/assets/slides/2020-09-25-slides-creative-audio-programming-for-the-web-with-tone-js.pdf</a></p>
<p>Real-time Human Pose Estimation in the Browser with TensorFlow.js</p>
<p><a target="_blank" rel="noopener" href="https://medium.com/tensorflow/real-time-human-pose-estimation-in-the-browser-with-tensorflow-js-7dd0bc881cd5">https://medium.com/tensorflow/real-time-human-pose-estimation-in-the-browser-with-tensorflow-js-7dd0bc881cd5</a></p>
<p>Generating Synthetic Music with JavaScript - Introduction to Neural Networks</p>
<p><a target="_blank" rel="noopener" href="https://medium.com/cactus-techblog/generating-synthetic-music-with-javascript-introduction-to-neural-networks-a0b258fade40">https://medium.com/cactus-techblog/generating-synthetic-music-with-javascript-introduction-to-neural-networks-a0b258fade40</a></p>
<p>MusicVAE: Creating a palette for musical scores with machine learning</p>
<p><a target="_blank" rel="noopener" href="https://magenta.tensorflow.org/music-vae">https://magenta.tensorflow.org/music-vae</a></p>
<p>Instrument samples</p>
<p><a target="_blank" rel="noopener" href="https://philharmonia.co.uk/resources/sound-samples/">https://philharmonia.co.uk/resources/sound-samples/</a></p>

    </div>

    <div class="about">
        <h1>About this Post</h1>
        <p>This post is written by Siqi Shu, licensed under <a
                target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a>.</p>
    </div>
</article>
        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h4 class="title">深智一物 眾隱皆變</h4>
                
            </div>
            
        </div>
        &copy; 2024 Siqi Shu<br />
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
</footer>


        
<script src="/js/main.js"></script>

        
<script src="/js/kursor.js"></script>

        
<script src="/js/run.js"></script>


    </body>
</html>
